{% extends 'buddy_crocker/base.html' %}

{% block title %}AI Recipe Generator - Buddy Crocker{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h1 class="display-5 fw-bold text-center mb-2">AI Recipe Generator</h1>
    <p class="text-center lead">
      Instantly create meal ideas from the ingredients you have in your pantry.
    </p>
  </div>
</div>
<div class="row mb-3">
  <div class="col-12 text-center">
    <h2 class="h5 mb-3">Your Current Pantry</h2>
    {% if ingredient_names %}
      <div class="mb-2">
        {% for ingredient in ingredient_names %}
          <span class="badge bg-info text-dark mx-1 px-3 py-2">{{ ingredient }}</span>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-info d-inline-block">
        Your pantry is empty! <a href="{% url 'pantry' %}">Add some ingredients</a> to get started.
      </div>
    {% endif %}
  </div>
</div>
{% if ingredient_names %}
  <div class="row mb-4">
    <div class="col-12 text-center">
      <form method="post">
        {% csrf_token %}
        <button type="submit" name="generate_recipes" class="btn btn-lg btn-primary">
          Generate Recipes
        </button>
      </form>
      <p class="mt-2 text-muted small">Results powered by AI suggestions based on your actual pantry contents.</p>
    </div>
  </div>
{% endif %}
{% if error_msg %}
  <div class="row mb-3">
    <div class="col-12">
      <div class="alert alert-danger text-center">{{ error_msg }}</div>
    </div>
  </div>
{% endif %}
{% if zipped_recipes_forms %}
  <div class="row justify-content-center mt-4">
    {% for recipe, form in zipped_recipes_forms %}
      <div class="col-md-6">
        <div class="card shadow mb-4">
          <div class="card-body">
            <h3 class="card-title h5 mb-3">
              <i class="bi bi-bookmark-star text-primary"></i>
              {{ recipe.title|default:"Recipe Suggestion" }}
            </h3>
            <h6 class="card-subtitle mb-2 text-muted">Ingredients used:</h6>
            <div class="mb-2">
              {% if recipe.ingredients %}
                {% for ing in recipe.ingredients %}
                  <span class="badge bg-secondary mx-1">{{ ing }}</span>
                {% endfor %}
              {% else %}
                <span>No ingredients listed.</span>
              {% endif %}
            </div>
            <p class="card-text" style="white-space: pre-line;">
              {{ recipe.instructions|default:"No instructions provided." }}
            </p>
            <form method="post" class="mt-3">
                {% csrf_token %}
                {{ form.title }}
                {{ form.instructions }}
                {{ form.ingredients }}
                <button type="submit" name="save_recipe" class="btn btn-primary">
                  Add This Recipe to My Profile
                </button>
              </form>              
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% elif ingredient_names and not error_msg %}
  <div class="row">
    <div class="col-12">
      <div class="alert alert-info text-center">
        No recipes generated yet. Click "Generate Recipes" above!
      </div>
    </div>
  </div>
{% endif %}

<div class="row mt-3">
  <div class="col-12 text-center">
    <a class="btn btn-link" href="{% url 'pantry' %}">
      <i class="bi bi-arrow-left-circle"></i> Back to My Pantry
    </a>
  </div>
</div>
{% endblock %}
