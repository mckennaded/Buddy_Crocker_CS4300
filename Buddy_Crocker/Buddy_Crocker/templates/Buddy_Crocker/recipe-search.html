{% extends 'Buddy_Crocker/base.html' %}
{% load static %}

{% block title %}Recipe Search - Buddy Crocker{% endblock %}

{% block content %}
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-5 fw-bold text-center mb-2">Recipe Search</h1>
      <p class="text-center lead">Find delicious recipes based on your pantry ingredients</p>
    </div>
  </div>

  <!--
  Class - Determines how the items within it will appear
  Form - Utilize a form to take in input
  Percent sign within brackets - A tag for the value inside the % signs
  Input - Take in standard input
  Label - Print out a variable
  Button - Something to click that will do something
  
  -->

  <!-- Recipe Search -->
  <div class="container-fluid">
    <!-- Centered Search Header -->
    <div class="row">
      <div class="col-12">
        <div class="container my-4">
          <div class="text-center mb-4">
            <h1 class="display-5 fw-bold">Find Your Perfect Recipe</h1>
            <p class="lead text-muted">Search through our collection of delicious recipes</p>
          </div>
          
          <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
              <form method="get" action="{% url 'recipe-search' %}">
                <!-- Preserve allergen filters -->
                {% for allergen_id in selected_allergen_ids %}
                  <input type="hidden" name="exclude_allergens" value="{{ allergen_id }}">
                {% endfor %}
                
                <div class="input-group input-group-lg shadow-sm">
                  <input type="text" name="q" class="form-control" 
                         placeholder="Search recipes by name..." 
                         value="{{ search_query }}"
                         aria-label="Search recipes">
                  <button class="btn btn-primary" type="submit">
                    <i class="bi bi-search"></i> Search
                  </button>
                </div>
              </form>
              
              {% if search_query %}
                <div class="text-center mt-2">
                  <small class="text-muted">
                    Searching for: <strong>{{ search_query }}</strong>
                    <a href="{% url 'recipe-search' %}{% if selected_allergen_ids %}?{% for aid in selected_allergen_ids %}exclude_allergens={{ aid }}{% if not forloop.last %}&{% endif %}{% endfor %}{% endif %}" 
                       class="ms-2 text-decoration-none">Clear search</a>
                  </small>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="row">
      <!-- Sidebar Filters -->
      <aside class="col-md-3 col-lg-2 mb-4">
        <!-- Allergen Filter Card (from above) -->
        <div class="card mb-3">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="bi bi-funnel"></i> Filter by Allergens
            </h5>
            <small class="text-muted">Exclude recipes containing these allergens</small>
          </div>
          <div class="card-body">
            <form method="get" action="{% url 'recipe-search' %}" id="allergen-filter-form">
              {% if search_query %}
                <input type="hidden" name="q" value="{{ search_query }}">
              {% endif %}
              
              {% for allergen in all_allergens %}
                <div class="form-check mb-2">
                  <input class="form-check-input" 
                         type="checkbox" 
                         name="exclude_allergens" 
                         value="{{ allergen.id }}"
                         id="allergen_{{ allergen.id }}"
                         {% if allergen.id in selected_allergen_ids %}checked{% endif %}
                         onchange="this.form.submit()">
                  <label class="form-check-label" for="allergen_{{ allergen.id }}">
                    {{ allergen.name }}
                    {% if allergen.id in user_profile_allergen_ids %}
                      <span class="badge bg-info text-white" style="font-size: 0.7em;" title="In your profile">
                        <i class="bi bi-person-fill"></i>
                      </span>
                    {% endif %}
                  </label>
                </div>
              {% endfor %}
              
              <noscript>
                <button type="submit" class="btn btn-sm btn-custom mt-3 w-100">
                  Apply Filters
                </button>
              </noscript>
              
              {% if selected_allergen_ids %}
                <div class="mt-3">
                  <a href="{% url 'recipe-search' %}{% if search_query %}?q={{ search_query }}{% endif %}" 
                     class="btn btn-sm btn-outline-secondary w-100">
                    <i class="bi bi-x-circle"></i> Clear Filters
                  </a>
                </div>
              {% endif %}
            </form>
          </div>
        </div>
      </aside>
      <!-- Recipe Results -->
      <main class="col-md-9 col-lg-10">
        <!-- Results Count -->
        <div class="mb-3">
          <p class="text-muted">
            Found <strong>{{ total_count }}</strong> recipe{{ total_count|pluralize }}
            {% if selected_allergen_ids %}
              <span class="badge bg-primary">
                {{ selected_allergen_ids }} allergen filter{{ selected_allergen_ids|length|pluralize }} active
              </span>
            {% endif %}
          </p>
        </div>

        <!-- Recipe grid -->

        <!-- Pagination -->

      </main>
    </div>
  </div>

  <!-- Coming Soon Card -->
  <!--
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card text-center coming-soon-card">
        <div class="card-body p-5">
          <i class="bi bi-search display-1 text-primary mb-4"></i>
          <h2 class="card-title mb-3">Recipe Search Coming Soon!</h2>
          <p class="card-text lead mb-4">
            We're working hard to bring you an amazing recipe search experience. 
            Soon you'll be able to discover recipes based on what's in your pantry.
          </p>
          <div class="feature-preview">
            <h5 class="text-primary mb-3">What's Coming:</h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                Search recipes by ingredients in your pantry
              </li>
              <li class="mb-2">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                Filter recipes by dietary preferences
              </li>
              <li class="mb-2">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                Save your favorite recipes
              </li>
              <li class="mb-2">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                Get nutritional information for each recipe
              </li>
            </ul>
          </div>
        </div>
      </div>
      -->



      <!-- Quick Actions -->
      <div class="row mt-4 g-3">
        <div class="col-md-6">
          <div class="card quick-action-card">
            <div class="card-body text-center">
              <i class="bi bi-basket2 text-primary display-6 mb-3"></i>
              <h5 class="card-title">Stock Your Pantry</h5>
              <p class="card-text">Add ingredients to get recipe recommendations</p>
              <a href="{% url 'pantry' %}" class="btn btn-custom mt-2">Go to Pantry</a>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card quick-action-card">
            <div class="card-body text-center">
              <i class="bi bi-plus-circle text-primary display-6 mb-3"></i>
              <h5 class="card-title">Add a Recipe</h5>
              <p class="card-text">Share your favorite recipes with the community</p>
              <a href="{% url 'add-recipe' %}" class="btn btn-custom mt-2">Add Recipe</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
